<!-- ---
title: 红黑树
tags: 
- 红黑树
categories: 
- 数据结构
--- -->

# 平衡二叉查找树

二叉树的时间复杂度：
- 树的各个操作的时间复杂度跟树的高度成正比，理想情况下，时间复杂度是O(logn)，即完全二叉树的时候性能是最好的(此时树的高度应为logn),但是极端情况下，二叉树会退化为链表，时间复杂度会退化到O(n)

平衡二叉查找树，是为了解决普通二叉查找树在频繁的插入、删除等动态更新的情况下，出现时间复杂度退化的问题

平衡二叉查找树核心思想
1. 二叉树中任意一个节点的左右子树的高度相差不能大于1
2. （完全二叉树、满二叉树其实都是平衡二叉树，但是非完全二叉树也有可能是平衡二叉树）

![平衡二叉树](https://raw.githubusercontent.com/FameLsy/Images/master/data/平衡二叉树.png)

平衡二叉树的种类
1. AVL树(严格符合平衡二叉查找树的定义)
2. Splay Tree（伸展树）
3. Treap（树堆)
4. 红黑树(使用最多，非严格符合平衡二叉查找树的定义)

# 红黑树

核心思想
1. 红黑树中的节点，一类被标记为黑色，一类被标记为红色
2. 根节点是黑色的；
3. 每个叶子节点都是黑色的空节点（NIL），也就是说，叶子节点不存储数据；
4. 任何相邻的节点都不能同时为红色，也就是说，红色节点是被黑色节点隔开的；
5. 每个节点，从该节点到达其可达叶子节点的所有路径，都包含相同数目的黑色节点；

以下红黑树去除了黑色的、空的叶子节

![红黑树](https://raw.githubusercontent.com/FameLsy/Images/master/data/红黑树.png)

## 红黑树的平衡调整

在插入、删除节点的过程中，红黑树的第三、第四点核心思想可能会被破坏，所谓的“平衡调整 ”，实际上就是要把被破坏的第三、第四点恢复过来

首先必须掌握两个重要的操作
1. 左旋
2. 右旋

![左右旋](https://raw.githubusercontent.com/FameLsy/Images/master/data/左右旋.png)

### 插入操作的平衡调整

红黑树规定，插入的节点必须是红色的。而且，二叉查找树中新插入的节点都是放在叶子节点上

特殊情况
1. 如果插入节点的父节点是黑色的，什么都不用做，它仍然满足红黑树的定义。
2. 如果插入的节点是根节点，直接改变它的颜色，把它变成黑色就可以了。

其他情况，需要两种基础的操作
1. 左右旋转
2. 改变颜色

红黑树的平衡调整过程是一个迭代的过程。我们把正在处理的节点叫作关注节点。关注节点会随着不停地迭代处理，而不断发生变化。最开始的关注节点就是新插入的节点

新节点插入之后，如果红黑树的平衡被打破，一般会有下面三种情况，根据不同情况，需要进行不同的调整

CASE 1：如果关注节点是a，它的叔叔节点d是红色
1. 将关注节点a的父节点b、叔叔节点d的颜色都设置成黑色；
2. 将关注节点a的祖父节点c的颜色设置成红色；
3. 关注节点变成a的祖父节点c；
4. 跳到CASE 2或者CASE 3。

![case1](https://raw.githubusercontent.com/FameLsy/Images/master/data/case1.png)

CASE 2：如果关注节点是a，它的叔叔节点d是黑色，关注节点a是其父节点b的右子节点
1. 关注节点变成节点a的父节点b；
2. 围绕新的关注节点 b左旋；
4. 跳到CASE 3。

![case2](https://raw.githubusercontent.com/FameLsy/Images/master/data/case2.png)

CASE 3：如果关注节点是a，它的叔叔节点d是黑色，关注节点a是其父节点b的左子节点
1. 围绕关注节点a的祖父节点c右旋；
2. 将关注节点a的父节点b、兄弟节点c的颜色互换。
3. 调整结束。

![case3](https://raw.githubusercontent.com/FameLsy/Images/master/data/case3.png)

### 删除操作的平衡调整